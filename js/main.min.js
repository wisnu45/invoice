function generateTableRow(){var e=document.createElement("tr");return e.innerHTML='<td><a class="cut">-</a><span contenteditable></span></td><td><span data-price contenteditable>0.00</span> <span data-prefix> DA</span></td><td><span contenteditable data-qty>1</span></td><td><span data-price>0.00</span> <span data-prefix> DA</span></td>',e}function parseFloatHTML(e){return parseFloat(e.innerHTML.replace(/[^\d\.\-]+/g,""))||0}function parsePrice(e){return e.toFixed(2).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1,")}function updateNumber(e){var t=document.activeElement,r=parseFloat(t.innerHTML),n=t.innerHTML==parsePrice(parseFloatHTML(t));isNaN(r)||38!=e.keyCode&&40!=e.keyCode&&!e.wheelDeltaY||(e.preventDefault(),r+=38==e.keyCode?1:40==e.keyCode?-1:Math.round(.025*e.wheelDelta),r=Math.max(r,0),t.innerHTML=n?parsePrice(r):r),updateInvoice()}function updateInvoice(){for(var e,t,r,n,a,r=0,n=document.querySelectorAll("table.inventory tbody tr"),a=0;n[a];++a)e=n[a].querySelectorAll("span[data-price]"),qty=n[a].querySelectorAll("span[data-qty]"),t=parseFloatHTML(e[0])*parseFloatHTML(qty[0]),r+=t,e[1].innerHTML=parsePrice(t);e=document.querySelectorAll("table.balance td:last-child span:first-child"),e[2].innerHTML=parsePrice(r),tva=document.querySelector("[data-tva]").innerHTML,tva=tva.match(/\d+/)[0],tva=parseInt(tva),e[1].innerHTML=parsePrice(tva*r/100),document.querySelector("span.total").innerHTML=parsePrice(r),e[0].innerHTML=parsePrice(r-parseFloatHTML(e[1]));var o=document.querySelector("#prefix").innerHTML;for(n=document.querySelectorAll("[data-prefix]"),a=0;n[a];++a)n[a].innerHTML=o;for(n=document.querySelectorAll("span[data-price]"),a=0;n[a];++a)document.activeElement!=n[a]&&(n[a].innerHTML=parsePrice(parseFloatHTML(n[a])))}function onContentLoad(){function e(e){var t,r=e.target.querySelector("[contenteditable]");r&&e.target!=document.documentElement&&e.target!=document.body&&r.focus(),e.target.matchesSelector(".add")?document.querySelector("table.inventory tbody").appendChild(generateTableRow()):"cut"==e.target.className&&(t=e.target.ancestorQuerySelector("tr"),t.parentNode.removeChild(t)),updateInvoice()}function t(e){e.preventDefault(),d.classList.add("hover")}function r(e){e.preventDefault(),d.classList.remove("hover")}function n(e){d.classList.remove("hover");var t=new FileReader,r=e.dataTransfer?e.dataTransfer.files:e.target.files,n=0;for(t.onload=a;r[n];)t.readAsDataURL(r[n++])}function a(e){var t=e.target.result;d.src=t}updateInvoice();var o=document.querySelector("input"),d=document.querySelector("img");window.addEventListener&&(document.addEventListener("click",e),document.addEventListener("mousewheel",updateNumber),document.addEventListener("keydown",updateNumber),document.addEventListener("keydown",updateInvoice),document.addEventListener("keyup",updateInvoice),o.addEventListener("focus",t),o.addEventListener("mouseover",t),o.addEventListener("dragover",t),o.addEventListener("dragenter",t),o.addEventListener("blur",r),o.addEventListener("dragleave",r),o.addEventListener("mouseout",r),o.addEventListener("drop",n),o.addEventListener("change",n))}var today=new Date,dd=today.getDate(),mm=today.getMonth()+1;dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),today=mm+"/"+dd+"/"+today.getFullYear(),document.querySelector("[data-today]").innerHTML=today,function(e,t,r,n){function a(){}a.prototype.length=r.length,t.matchesSelector=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector||function(e){},t.ancestorQuerySelectorAll=t.ancestorQuerySelectorAll||t.mozAncestorQuerySelectorAll||t.msAncestorQuerySelectorAll||t.oAncestorQuerySelectorAll||t.webkitAncestorQuerySelectorAll||function(e){for(var t=this,n=new a;t=t.parentElement;)t.matchesSelector(e)&&r.push.call(n,t);return n},t.ancestorQuerySelector=t.ancestorQuerySelector||t.mozAncestorQuerySelector||t.msAncestorQuerySelector||t.oAncestorQuerySelector||t.webkitAncestorQuerySelector||function(e){return this.ancestorQuerySelectorAll(e)[0]||null}}(this,Element.prototype,Array.prototype),window.addEventListener&&document.addEventListener("DOMContentLoaded",onContentLoad);